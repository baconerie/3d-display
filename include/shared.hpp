#pragma once

#include <cstdint>

#include <gtk/gtk.h>
#include <glibmm.h>

#include <opencv2/videoio.hpp>
#include <opencv2/objdetect/face.hpp>
#include <opencv2/core/types.hpp>

#include <boost/asio.hpp>
#include <boost/process.hpp>

#include <mutex>
#include <atomic>
#include <thread>
#include <fstream>
#include <iostream>

namespace shared_vars {
    extern GdkPaintable* webcam_paintable;

    extern GtkBuilder *builder;

    extern std::mutex webcam_paintable_mutex;
    extern cv::VideoCapture webcam_capture;
    extern Glib::Dispatcher webcam_dispatcher;
    extern cv::Ptr<cv::FaceDetectorYN> face_detector_pointer;
    extern cv::Rect bounding_box;

    extern GtkPicture* main_webcam_image;
    extern GtkPicture* fov_webcam_image;

    extern GtkStack* stack_widget;

    extern GtkEditable* qr_code_distance_editable;
    extern GtkEditable* lenticule_density_editable;
    extern GtkEditable* green_red_line_distance_editable;
    extern GtkEditable* index_of_refraction_editable;
    extern GtkEditable* horizontal_displacement_editable;
    extern GtkEditable* vertical_displacement_editable;

    extern std::thread cv_process_thread;
    extern bool is_current_cv_action_face;
    extern std::atomic<bool> do_cv_thread_run;

    extern boost::asio::io_context io_context;
    extern boost::asio::ip::tcp::socket renderer_socket;
    extern boost::asio::ip::tcp::endpoint endpoint;
    extern boost::asio::ip::tcp::acceptor acceptor;

    extern bool is_renderer_active;

    extern double left_eye_horizontal_angle;
    extern double right_eye_horizontal_angle;
    extern double left_eye_vertical_angle;
    extern double right_eye_vertical_angle;

    extern boost::process::child* renderer_program;

    void listen_for_renderer_socket_and_call_dispatcher(); // Run this in a new thread, because socket accept blocks.
}

namespace working_parameters {
    extern float qr_code_distance;
    extern float qr_code_inverse_proportion;
    extern float lenticule_density;
    extern float green_to_red_line_distance;
}

namespace parameters {
    extern float webcam_fov_deg;
    extern float pixels_per_lens;
    extern float index_of_refraction;
}